<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmpoweredAI Tech Community Events</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“…</text></svg>">
    
    <!-- React with Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Include Feather Icons for better compatibility -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    
    <style>
        body {
            background-color: #f5f5f5;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            max-width: 32rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            cursor: pointer;
            color: #4b5563;
        }
        
        .close-button:hover {
            color: #111827;
        }
        
        .rotate-icon {
            transform: rotate(90deg);
            transition: transform 0.2s;
        }
        
        .version-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.75rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="version-badge">v1.04</div>

    <!-- Main App -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // Simple icon component using Feather Icons
        const Icon = ({ name, className = "", size = 16 }) => {
            const iconRef = useRef();
            
            useEffect(() => {
                if (iconRef.current && window.feather) {
                    feather.replace({
                        width: size,
                        height: size
                    });
                }
            }, []);
            
            return (
                <i ref={iconRef} data-feather={name} className={className}></i>
            );
        };
        
        // Simple Dialog component
        const Dialog = ({ open, onOpenChange, children }) => {
            if (!open) return null;
            
            return (
                <div className="modal-backdrop" onClick={() => onOpenChange(false)}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <button 
                            onClick={() => onOpenChange(false)} 
                            className="close-button"
                            aria-label="Close dialog"
                        >
                            <Icon name="x" size={24} />
                        </button>
                        {children}
                    </div>
                </div>
            );
        };
        
        const DialogContent = ({ children, className }) => (
            <div className={`space-y-4 ${className || ''}`}>{children}</div>
        );
        
        const DialogHeader = ({ children }) => (
            <div className="mb-4">{children}</div>
        );
        
        const DialogTitle = ({ children }) => (
            <h3 className="text-xl font-semibold">{children}</h3>
        );
        
        // iCalendar helper functions
        const generateICalendar = (eventData, recurringEvents) => {
            let icalContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//EmpoweredAI//Tech Community Calendar//EN',
                'X-WR-CALNAME:EmpoweredAI Tech Community Events',
                'X-WR-CALDESC:Calendar for EmpoweredAI Tech Community Events',
                'X-WR-TIMEZONE:America/New_York',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH'
            ];
            
            // Process one-time events
            if (eventData.oneTime && Array.isArray(eventData.oneTime)) {
                eventData.oneTime.forEach(event => {
                    if (!event || !event.date) return; // Skip invalid events
                    
                    const startDate = new Date(event.date);
                    // End date is start date + 1 hour by default
                    const endDate = new Date(startDate.getTime() + 60 * 60 * 1000);
                    
                    const formattedStart = formatDateForICal(startDate);
                    const formattedEnd = formatDateForICal(endDate);
                    
                    icalContent.push('BEGIN:VEVENT');
                    icalContent.push(`UID:${event.id}@empoweredai.org`);
                    icalContent.push(`DTSTAMP:${formatDateForICal(new Date())}`);
                    icalContent.push(`DTSTART:${formattedStart}`);
                    icalContent.push(`DTEND:${formattedEnd}`);
                    icalContent.push(`SUMMARY:${escapeICalText(event.title)}`);
                    icalContent.push(`DESCRIPTION:${escapeICalText(event.description)}`);
                    
                    if (event.location) {
                        icalContent.push(`LOCATION:${escapeICalText(event.location)}`);
                    }
                    
                    if (event.organizer) {
                        icalContent.push(`ORGANIZER;CN=${escapeICalText(event.organizer)}:MAILTO:info@empoweredai.org`);
                    }
                    
                    icalContent.push('END:VEVENT');
                });
            }
            
            // Process recurring events with recurring instances pre-calculated
            if (recurringEvents && Array.isArray(recurringEvents)) {
                recurringEvents.forEach(event => {
                    if (!event || !event.date) return; // Skip invalid events
                    
                    const startDate = new Date(event.date);
                    // End date is start date + 1 hour by default
                    const endDate = new Date(startDate.getTime() + 60 * 60 * 1000);
                    
                    const formattedStart = formatDateForICal(startDate);
                    const formattedEnd = formatDateForICal(endDate);
                    
                    icalContent.push('BEGIN:VEVENT');
                    icalContent.push(`UID:${event.id}@empoweredai.org`);
                    icalContent.push(`DTSTAMP:${formatDateForICal(new Date())}`);
                    icalContent.push(`DTSTART:${formattedStart}`);
                    icalContent.push(`DTEND:${formattedEnd}`);
                    icalContent.push(`SUMMARY:${escapeICalText(event.title)}`);
                    icalContent.push(`DESCRIPTION:${escapeICalText(event.description)}`);
                    
                    if (event.location) {
                        icalContent.push(`LOCATION:${escapeICalText(event.location)}`);
                    }
                    
                    if (event.organizers && event.organizers.length > 0) {
                        icalContent.push(`ORGANIZER;CN=${escapeICalText(event.organizers.join(', '))}:MAILTO:info@empoweredai.org`);
                    }
                    
                    icalContent.push('END:VEVENT');
                });
            }
            
            icalContent.push('END:VCALENDAR');
            return icalContent.join('\r\n');
        };
        
        const formatDateForICal = (date) => {
            return date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
        };
        
        const escapeICalText = (text) => {
            if (!text) return '';
            return text.replace(/[\\\n;,]/g, (match) => {
                if (match === '\n') return '\\n';
                return '\\' + match;
            });
        };
        
        // Admin Panel for exporting events
        const AdminPanel = ({ eventData, recurringEvents, onResetLocalEvents }) => {
            const [isOpen, setIsOpen] = useState(false);
            
            const handleExportJSON = () => {
                // Create formatted JSON string
                const jsonData = JSON.stringify(eventData, null, 2);
                
                // Create blob and download link
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'events.json';
                a.click();
                URL.revokeObjectURL(url);
            };
            
            const handleCopyJSON = () => {
                const jsonData = JSON.stringify(eventData, null, 2);
                navigator.clipboard.writeText(jsonData)
                    .then(() => alert('JSON copied to clipboard!'))
                    .catch(err => alert('Failed to copy: ' + err));
            };
            
            const handleExportICalendar = () => {
                const icalContent = generateICalendar(eventData, recurringEvents);
                const blob = new Blob([icalContent], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'empoweredai_events.ics';
                a.click();
                URL.revokeObjectURL(url);
            };
            
            const handleResetLocalEvents = () => {
                if (confirm('Are you sure you want to reset all local events? This will remove all events you have created or modified locally.')) {
                    onResetLocalEvents();
                    alert('Local events have been reset. The page will now reload.');
                    window.location.reload();
                }
            };
            
            return (
                <>
                    <button 
                        onClick={() => setIsOpen(true)}
                        className="fixed bottom-4 right-4 bg-gray-700 text-white p-2 rounded-full shadow-lg hover:bg-gray-600"
                        title="Admin Tools"
                    >
                        <Icon name="settings" size={24} />
                    </button>
                    
                    <Dialog open={isOpen} onOpenChange={setIsOpen}>
                        <DialogContent className="sm:max-w-xl">
                            <DialogHeader>
                                <DialogTitle>Admin Tools</DialogTitle>
                            </DialogHeader>
                            
                            <div className="space-y-6">
                                <div>
                                    <h3 className="text-lg font-medium mb-2">Export Options</h3>
                                    <p className="text-gray-600 mb-4">
                                        Export the current calendar data to update your events.json file.
                                    </p>
                                    <div className="flex flex-wrap gap-3">
                                        <button
                                            onClick={handleExportJSON}
                                            className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                        >
                                            <Icon name="download" />
                                            <span>Download events.json</span>
                                        </button>
                                        <button
                                            onClick={handleCopyJSON}
                                            className="flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                                        >
                                            <Icon name="clipboard" />
                                            <span>Copy to Clipboard</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 className="text-lg font-medium mb-2">Calendar Subscription</h3>
                                    <p className="text-gray-600 mb-4">
                                        Download the iCalendar file to import or subscribe in your calendar application.
                                    </p>
                                    <button
                                        onClick={handleExportICalendar}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                    >
                                        <Icon name="calendar" />
                                        <span>Download Calendar (.ics)</span>
                                    </button>
                                </div>
                                
                                <div>
                                    <h3 className="text-lg font-medium mb-2 text-red-600">Danger Zone</h3>
                                    <p className="text-gray-600 mb-4">
                                        Reset all locally stored events. This cannot be undone.
                                    </p>
                                    <button
                                        onClick={handleResetLocalEvents}
                                        className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                                    >
                                        <Icon name="trash-2" />
                                        <span>Reset All Local Events</span>
                                    </button>
                                </div>
                                
                                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                    <div className="flex items-start">
                                        <div className="flex-shrink-0 mt-0.5">
                                            <Icon name="info" className="text-yellow-400" />
                                        </div>
                                        <div className="ml-3">
                                            <h3 className="text-sm font-medium text-yellow-800">Important Note</h3>
                                            <div className="text-sm text-yellow-700 mt-2">
                                                <p className="mb-2">
                                                    Changes made to events are stored in your browser's local storage. 
                                                    To make these changes permanent in the GitHub repository, download 
                                                    the updated events.json file and replace the existing one in your repo.
                                                </p>
                                                <p>
                                                    The calendar subscription file (.ics) can be imported into Google Calendar, 
                                                    Apple Calendar, Outlook, and other calendar applications.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </DialogContent>
                    </Dialog>
                </>
            );
        };
        
        // Sponsors View Component
        const SponsorsView = ({ eventData, recurringEvents, formatDate, onEventClick }) => {
            const [expandedSponsors, setExpandedSponsors] = useState({});
            
            // Function to toggle collapse/expand for a sponsor
            const toggleSponsor = (sponsor) => {
                setExpandedSponsors(prev => ({
                    ...prev,
                    [sponsor]: !prev[sponsor]
                }));
            };
            
            // Get all sponsors and their events
            const sponsorsWithEvents = useMemo(() => {
                const sponsors = new Map();
                
                // Helper function to process events for a sponsor
                const processEventForSponsor = (event, sponsorName) => {
                    if (!sponsors.has(sponsorName)) {
                        sponsors.set(sponsorName, []);
                    }
                    sponsors.get(sponsorName).push(event);
                };
                
                // Process one-time events
                if (eventData.oneTime && Array.isArray(eventData.oneTime)) {
                    eventData.oneTime.forEach(event => {
                        if (event.sponsors && event.sponsors.length > 0) {
                            event.sponsors.forEach(sponsor => {
                                processEventForSponsor(event, sponsor);
                            });
                        }
                    });
                }
                
                // Process recurring events
                if (recurringEvents && Array.isArray(recurringEvents)) {
                    recurringEvents.forEach(event => {
                        if (event.sponsors && event.sponsors.length > 0) {
                            event.sponsors.forEach(sponsor => {
                                processEventForSponsor(event, sponsor);
                            });
                        }
                    });
                }
                
                // Convert to array and sort by sponsor name
                return Array.from(sponsors.entries())
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([sponsor, events]) => ({
                        name: sponsor,
                        events: events.sort((a, b) => new Date(a.date) - new Date(b.date))
                    }));
            }, [eventData, recurringEvents]);
            
            // Initialize all sponsors to be expanded by default
            useEffect(() => {
                const initialExpandState = {};
                sponsorsWithEvents.forEach(sponsor => {
                    initialExpandState[sponsor.name] = true; // Start expanded
                });
                setExpandedSponsors(initialExpandState);
            }, [sponsorsWithEvents]);
            
            // The event card component
            const EventCard = ({ event }) => {
                const eventDate = new Date(event.date);
                const formattedDate = `${eventDate.getDate()} ${MONTHS[eventDate.getMonth()]}`;
                
                return (
                    <div 
                        className={`${EVENT_COLORS[event.type]} p-3 rounded mb-2 cursor-pointer hover:opacity-90`}
                        onClick={() => onEventClick(event)}
                    >
                        <div className="flex justify-between items-center">
                            <div>
                                <span className="font-semibold">{event.title}</span>
                                <div className="text-sm">
                                    <span className="flex items-center gap-1">
                                        <Icon name="calendar" />
                                        {formattedDate}
                                    </span>
                                </div>
                            </div>
                            <div className="flex items-center gap-1">
                                {event.needsSponsors && <Icon name="dollar-sign" />}
                                {event.newsWorthy && <Icon name="star" />}
                                {event.isMajor && <Icon name="zap" className="text-yellow-500" />}
                            </div>
                        </div>
                    </div>
                );
            };
            
            if (sponsorsWithEvents.length === 0) {
                return (
                    <div className="p-6 bg-white rounded-lg shadow-md">
                        <h2 className="text-2xl font-bold mb-4">No sponsors found</h2>
                        <p>There are currently no events with sponsors in the calendar.</p>
                    </div>
                );
            }
            
            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-bold">Event Sponsors</h1>
                    
                    {sponsorsWithEvents.map(sponsor => (
                        <div key={sponsor.name} className="bg-white rounded-lg shadow-md overflow-hidden">
                            <div 
                                className="p-4 bg-gray-50 flex justify-between items-center cursor-pointer hover:bg-gray-100"
                                onClick={() => toggleSponsor(sponsor.name)}
                            >
                                <h2 className="text-xl font-semibold">{sponsor.name}</h2>
                                <div className={`transition-transform ${expandedSponsors[sponsor.name] ? 'rotate-90' : ''}`}>
                                    <Icon name="chevron-right" />
                                </div>
                            </div>
                            
                            {expandedSponsors[sponsor.name] && (
                                <div className="p-4">
                                    <p className="mb-3 text-gray-600">
                                        Sponsoring {sponsor.events.length} event{sponsor.events.length !== 1 ? 's' : ''}
                                    </p>
                                    <div className="space-y-2">
                                        {sponsor.events.map(event => (
                                            <EventCard key={event.id} event={event} />
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );
        };
        
        // Event Creator Component
        const EventCreator = ({ onSaveEvent, onCancel, onDeleteEvent, editEvent = null }) => {
            const [isRecurring, setIsRecurring] = useState(editEvent ? editEvent.type === 'recurring' : false);
            const [formData, setFormData] = useState(() => {
                if (editEvent) {
                    // If we're editing, populate the form with the event data
                    if (editEvent.type === 'recurring') {
                        // Format for recurring event
                        return {
                            id: editEvent.id,
                            title: editEvent.title,
                            type: 'recurring',
                            description: editEvent.description,
                            location: editEvent.location || '',
                            organizers: editEvent.organizers ? editEvent.organizers.join(', ') : '',
                            sponsors: editEvent.sponsors ? editEvent.sponsors.join(', ') : '',
                            needsSponsors: editEvent.needsSponsors || false,
                            isMajor: editEvent.isMajor || false,
                            newsWorthy: editEvent.newsWorthy || false,
                            dayOfWeek: editEvent.dayOfWeek || 0,
                            occurrences: editEvent.occurrences ? editEvent.occurrences.join(', ') : ''
                        };
                    } else {
                        // Format for one-time event
                        return {
                            id: editEvent.id,
                            title: editEvent.title,
                            type: editEvent.type,
                            date: editEvent.date ? editEvent.date.substring(0, 10) : '', // Extract YYYY-MM-DD
                            description: editEvent.description,
                            organizer: editEvent.organizer || '',
                            location: editEvent.location || '',
                            sponsors: editEvent.sponsors ? editEvent.sponsors.join(', ') : '',
                            needsSponsors: editEvent.needsSponsors || false,
                            isMajor: editEvent.isMajor || false,
                            newsWorthy: editEvent.newsWorthy || false
                        };
                    }
                } else {
                    // Default empty form for new event
                    return {
                        title: "",
                        type: "meetup",
                        date: "",
                        description: "",
                        organizer: "",
                        organizers: "",
                        sponsors: "",
                        needsSponsors: false,
                        isMajor: false,
                        newsWorthy: false,
                        location: "",
                        dayOfWeek: 1, // Monday
                        occurrences: "1, 3" // 1st and 3rd occurrences
                    };
                }
            });
            
            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: type === 'checkbox' ? checked : value
                }));
            };
            
            const handleEventTypeChange = (e) => {
                const newValue = e.target.value;
                setIsRecurring(newValue === 'recurring');
                setFormData(prev => ({
                    ...prev,
                    type: newValue
                }));
            };

            const handleDelete = () => {
                if (confirm(`Are you sure you want to delete "${editEvent.title}"? This cannot be undone.`)) {
                    onDeleteEvent(editEvent);
                }
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Process sponsors string into array
                const sponsorsArray = formData.sponsors
                    ? formData.sponsors.split(',').map(s => s.trim()).filter(s => s !== "")
                    : [];
                
                if (isRecurring) {
                    // Handle recurring event
                    const organizersArray = formData.organizers
                        ? formData.organizers.split(',').map(s => s.trim()).filter(s => s !== "")
                        : [];
                    
                    const occurrencesArray = formData.occurrences
                        ? formData.occurrences.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n))
                        : [];
                    
                    const recurringEvent = {
                        id: formData.id || `recurring-${Date.now()}`,
                        title: formData.title,
                        type: 'recurring',
                        description: formData.description,
                        location: formData.location,
                        organizers: organizersArray,
                        dayOfWeek: parseInt(formData.dayOfWeek),
                        occurrences: occurrencesArray,
                        sponsors: sponsorsArray,
                        needsSponsors: formData.needsSponsors,
                        isMajor: formData.isMajor,
                        newsWorthy: formData.newsWorthy
                    };
                    
                    onSaveEvent(recurringEvent, editEvent ? true : false);
                } else {
                    // Handle one-time event
                    const oneTimeEvent = {
                        id: formData.id || `event-${Date.now()}`,
                        title: formData.title,
                        type: formData.type,
                        date: formData.date,
                        description: formData.description,
                        organizer: formData.organizer,
                        location: formData.location,
                        sponsors: sponsorsArray,
                        needsSponsors: formData.needsSponsors,
                        isMajor: formData.isMajor,
                        newsWorthy: formData.newsWorthy
                    };
                    
                    onSaveEvent(oneTimeEvent, editEvent ? true : false);
                }
            };
            
            return (
                <div className="p-4">
                    <h2 className="text-2xl font-bold mb-4">
                        {editEvent ? 'Edit Event' : 'Create New Event'}
                    </h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="space-y-2">
                            <div className="flex items-center">
                                <input
                                    type="radio"
                                    id="oneTimeEvent"
                                    name="eventType"
                                    checked={!isRecurring}
                                    value="meetup"
                                    onChange={handleEventTypeChange}
                                    className="h-4 w-4 text-blue-600 border-gray-300"
                                />
                                <label htmlFor="oneTimeEvent" className="ml-2 block text-sm text-gray-700">
                                    One-time Event
                                </label>
                            </div>
                            
                            <div className="flex items-center">
                                <input
                                    type="radio"
                                    id="recurringEvent"
                                    name="eventType"
                                    checked={isRecurring}
                                    value="recurring"
                                    onChange={handleEventTypeChange}
                                    className="h-4 w-4 text-blue-600 border-gray-300"
                                />
                                <label htmlFor="recurringEvent" className="ml-2 block text-sm text-gray-700">
                                    Recurring Event
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Event Title*
                            </label>
                            <input
                                type="text"
                                name="title"
                                value={formData.title}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                required
                            />
                        </div>
                        
                        {!isRecurring && (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Event Type*
                                    </label>
                                    <select
                                        name="type"
                                        value={formData.type}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        required
                                    >
                                        <option value="meetup">Meetup</option>
                                        <option value="workshop">Workshop</option>
                                        <option value="conference">Conference</option>
                                        <option value="hackathon">Hackathon</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Date*
                                    </label>
                                    <input
                                        type="date"
                                        name="date"
                                        value={formData.date}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        required
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Organizer*
                                    </label>
                                    <input
                                        type="text"
                                        name="organizer"
                                        value={formData.organizer}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        required
                                    />
                                </div>
                            </>
                        )}
                        
                        {isRecurring && (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Day of Week*
                                    </label>
                                    <select
                                        name="dayOfWeek"
                                        value={formData.dayOfWeek}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        required
                                    >
                                        <option value="0">Sunday</option>
                                        <option value="1">Monday</option>
                                        <option value="2">Tuesday</option>
                                        <option value="3">Wednesday</option>
                                        <option value="4">Thursday</option>
                                        <option value="5">Friday</option>
                                        <option value="6">Saturday</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Occurrences (comma-separated, e.g., "1, 3" for 1st and 3rd weeks)*
                                    </label>
                                    <input
                                        type="text"
                                        name="occurrences"
                                        value={formData.occurrences}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        placeholder="1, 3"
                                        required
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Organizers (comma-separated)*
                                    </label>
                                    <input
                                        type="text"
                                        name="organizers"
                                        value={formData.organizers}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        required
                                    />
                                </div>
                            </>
                        )}
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Description*
                            </label>
                            <textarea
                                name="description"
                                value={formData.description}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                rows="3"
                                required
                            ></textarea>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Location
                            </label>
                            <input
                                type="text"
                                name="location"
                                value={formData.location}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                            />
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Sponsors (comma separated)
                            </label>
                            <input
                                type="text"
                                name="sponsors"
                                value={formData.sponsors}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="EmpoweredAI, TechCorp, etc."
                            />
                        </div>
                        
                        <div className="space-y-2">
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="needsSponsors"
                                    name="needsSponsors"
                                    checked={formData.needsSponsors}
                                    onChange={handleChange}
                                    className="h-4 w-4 text-blue-600 border-gray-300 rounded"
                                />
                                <label htmlFor="needsSponsors" className="ml-2 block text-sm text-gray-700">
                                    Needs Sponsors
                                </label>
                            </div>
                            
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="isMajor"
                                    name="isMajor"
                                    checked={formData.isMajor}
                                    onChange={handleChange}
                                    className="h-4 w-4 text-blue-600 border-gray-300 rounded"
                                />
                                <label htmlFor="isMajor" className="ml-2 block text-sm text-gray-700">
                                    Major Event
                                </label>
                            </div>
                            
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="newsWorthy"
                                    name="newsWorthy"
                                    checked={formData.newsWorthy}
                                    onChange={handleChange}
                                    className="h-4 w-4 text-blue-600 border-gray-300 rounded"
                                />
                                <label htmlFor="newsWorthy" className="ml-2 block text-sm text-gray-700">
                                    News Worthy
                                </label>
                            </div>
                        </div>
                        
                        <div className="flex flex-wrap gap-3 pt-2">
                            <button
                                type="submit"
                                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                            >
                                {editEvent ? 'Update Event' : 'Save Event'}
                            </button>
                            <button
                                type="button"
                                onClick={onCancel}
                                className="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400"
                            >
                                Cancel
                            </button>
                            
                            {editEvent && (
                                <button
                                    type="button"
                                    onClick={handleDelete}
                                    className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 ml-auto"
                                >
                                    Delete Event
                                </button>
                            )}
                        </div>
                    </form>
                </div>
            );
        };
        
        const MONTHS = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        const EVENT_COLORS = {
            workshop: 'bg-red-400',
            conference: 'bg-green-400',
            hackathon: 'bg-purple-400',
            meetup: 'bg-yellow-400',
            recurring: 'bg-blue-400'
        };

        function getNthDayOfMonth(year, month, dayOfWeek, n) {
            const firstDay = new Date(year, month, 1);
            const firstTargetDay = new Date(firstDay);
            
            // Adjust to first occurrence of target day
            while (firstTargetDay.getDay() !== dayOfWeek) {
                firstTargetDay.setDate(firstTargetDay.getDate() + 1);
            }
            
            // Add weeks to get to nth occurrence
            const targetDay = new Date(firstTargetDay);
            targetDay.setDate(firstTargetDay.getDate() + (n - 1) * 7);
            
            // If we've moved to next month, return null
            if (targetDay.getMonth() !== month) return null;
            
            return targetDay;
        }
        
        // Main TechCalendar component
        const TechCalendar = () => {
            const [baseEventData, setBaseEventData] = useState({ recurring: [], oneTime: [] });
            const [localEvents, setLocalEvents] = useState([]);
            const [localRecurringEvents, setLocalRecurringEvents] = useState([]);
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [isDialogOpen, setIsDialogOpen] = useState(false);
            const [viewMode, setViewMode] = useState('calendar'); // 'calendar' or 'sponsors'
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isCreateEventOpen, setIsCreateEventOpen] = useState(false);
            const [editingEvent, setEditingEvent] = useState(null);
            
            // Combined event data (base + local)
            const eventData = useMemo(() => {
                return {
                    recurring: Array.isArray(baseEventData.recurring) 
                        ? [...baseEventData.recurring, ...localRecurringEvents]
                        : [...localRecurringEvents],
                    oneTime: Array.isArray(baseEventData.oneTime)
                        ? [...baseEventData.oneTime, ...localEvents]
                        : [...localEvents]
                };
            }, [baseEventData, localEvents, localRecurringEvents]);

            // Load events from remote and local storage
            useEffect(() => {
                const loadEvents = async () => {
                    setLoading(true);
                    
                    // Try to load events from local storage first
                    const storedOneTimeEvents = localStorage.getItem('techCalendarEvents');
                    const storedRecurringEvents = localStorage.getItem('techCalendarRecurringEvents');
                    
                    let localEventsList = [];
                    let localRecurringList = [];
                    
                    if (storedOneTimeEvents) {
                        try {
                            localEventsList = JSON.parse(storedOneTimeEvents);
                            setLocalEvents(localEventsList);
                        } catch (error) {
                            console.error('Error parsing local events:', error);
                            // Clear corrupted data
                            localStorage.removeItem('techCalendarEvents');
                        }
                    }
                    
                    if (storedRecurringEvents) {
                        try {
                            localRecurringList = JSON.parse(storedRecurringEvents);
                            setLocalRecurringEvents(localRecurringList);
                        } catch (error) {
                            console.error('Error parsing local recurring events:', error);
                            // Clear corrupted data
                            localStorage.removeItem('techCalendarRecurringEvents');
                        }
                    }
                    
                    // Then try to fetch events from remote
                    const possiblePaths = [
                        './public/data/events.json',
                        './data/events.json',
                        './events.json'
                    ];
                    
                    let fetchedRemote = false;
                    
                    for (const path of possiblePaths) {
                        try {
                            console.log(`Attempting to fetch from: ${path}`);
                            const response = await fetch(path);
                            
                            if (response.ok) {
                                try {
                                    const data = await response.json();
                                    console.log('Data fetched successfully from:', path);
                                    
                                    // Ensure data has the correct structure
                                    const safeData = {
                                        recurring: Array.isArray(data.recurring) ? data.recurring : [],
                                        oneTime: Array.isArray(data.oneTime) ? data.oneTime : []
                                    };
                                    
                                    setBaseEventData(safeData);
                                    fetchedRemote = true;
                                    break;
                                } catch (parseError) {
                                    console.error('Error parsing JSON:', parseError);
                                    // JSON was invalid, use empty arrays
                                    setBaseEventData({ recurring: [], oneTime: [] });
                                    fetchedRemote = true;
                                    break;
                                }
                            }
                        } catch (err) {
                            console.log(`Failed to fetch from ${path}:`, err);
                        }
                    }
                    
                    if (!fetchedRemote && localEventsList.length === 0 && localRecurringList.length === 0) {
                        setError("Couldn't load calendar data. Please check the events.json location.");
                    } else if (!fetchedRemote) {
                        // We have local events but no remote - create an empty base
                        setBaseEventData({ recurring: [], oneTime: [] });
                    }
                    
                    setLoading(false);
                };
                
                loadEvents();
            }, []);

            // Initialize feather icons after render
            useEffect(() => {
                if (window.feather) {
                    feather.replace();
                }
            });
            
            // Handle reset of local events
            const handleResetLocalEvents = () => {
                localStorage.removeItem('techCalendarEvents');
                localStorage.removeItem('techCalendarRecurringEvents');
                setLocalEvents([]);
                setLocalRecurringEvents([]);
            };
            
            // Handle toggle between calendar and sponsors view
            const toggleView = () => {
                console.log("Toggle view, current mode:", viewMode);
                setViewMode(viewMode === 'calendar' ? 'sponsors' : 'calendar');
            };
            
            // Handle deleting an event
            const handleDeleteEvent = (event) => {
                if (event.type === 'recurring') {
                    // Delete recurring event
                    if (event.id && event.id.startsWith('recurring-')) {
                        // It's a locally created recurring event
                        const updatedRecurring = localRecurringEvents.filter(e => e.id !== event.id);
                        setLocalRecurringEvents(updatedRecurring);
                        localStorage.setItem('techCalendarRecurringEvents', JSON.stringify(updatedRecurring));
                    } else {
                        // It's a base event, we'll add a "tombstone" or just filter it out of our view
                        // For now, just filter it locally
                        const updatedRecurring = localRecurringEvents.filter(e => e.id !== event.id);
                        setLocalRecurringEvents(updatedRecurring);
                        localStorage.setItem('techCalendarRecurringEvents', JSON.stringify(updatedRecurring));
                    }
                } else {
                    // Delete one-time event
                    if (event.id && event.id.startsWith('event-')) {
                        // It's a locally created event
                        const updatedEvents = localEvents.filter(e => e.id !== event.id);
                        setLocalEvents(updatedEvents);
                        localStorage.setItem('techCalendarEvents', JSON.stringify(updatedEvents));
                    } else {
                        // It's a base event, we'll filter it locally
                        const updatedEvents = localEvents.filter(e => e.id !== event.id);
                        setLocalEvents(updatedEvents);
                        localStorage.setItem('techCalendarEvents', JSON.stringify(updatedEvents));
                    }
                }
                
                // Show success message and close editor
                alert(`Event "${event.title}" has been deleted.`);
                setIsCreateEventOpen(false);
                setEditingEvent(null);
            };

            const recurringEvents = useMemo(() => {
                const events = [];
                const year = 2025;

                if (eventData.recurring && Array.isArray(eventData.recurring)) {
                    eventData.recurring.forEach(event => {
                        if (!event.dayOfWeek || !event.occurrences || !Array.isArray(event.occurrences)) {
                            return; // Skip invalid recurring events
                        }
                        
                        for (let month = 0; month < 12; month++) {
                            event.occurrences.forEach(occurrence => {
                                const date = getNthDayOfMonth(year, month, event.dayOfWeek, occurrence);
                                if (date) {
                                    events.push({
                                        ...event,
                                        date: date.toISOString(),
                                        id: `${event.id}-${date.toISOString()}`
                                    });
                                }
                            });
                        }
                    });
                }

                return events;
            }, [eventData.recurring]);

            const getEventsForMonth = (monthIndex) => {
                const oneTimeEvents = eventData.oneTime && Array.isArray(eventData.oneTime) 
                    ? eventData.oneTime.filter(
                        event => event.date && new Date(event.date).getMonth() === monthIndex
                      )
                    : [];

                const monthlyRecurringEvents = recurringEvents && Array.isArray(recurringEvents)
                    ? recurringEvents.filter(
                        event => event.date && new Date(event.date).getMonth() === monthIndex
                      )
                    : [];

                return [...oneTimeEvents, ...monthlyRecurringEvents].sort(
                    (a, b) => new Date(a.date) - new Date(b.date)
                );
            };

            // Helper function to format date
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            };
            
            // Handle clicking on an event
            const handleEventClick = (event) => {
                // Find the original event (not the recurring instance)
                let originalEvent = event;
                
                // If this is a recurring event instance, find the original template
                if (event.id && event.id.includes('-202')) { // It's a recurring instance with date in ID
                    const baseId = event.id.split('-2')[0]; // Get the base ID part
                    
                    // Look for the original recurring event
                    const recurringTemplate = eventData.recurring.find(e => e && e.id === baseId);
                    if (recurringTemplate) {
                        originalEvent = {
                            ...recurringTemplate,
                            instanceDate: event.date // Keep the specific date for reference
                        };
                    }
                }
                
                setSelectedEvent(originalEvent);
                setIsDialogOpen(true);
            };
            
            // Handle editing an event
            const handleEditEvent = () => {
                setEditingEvent(selectedEvent);
                setIsDialogOpen(false);
                setIsCreateEventOpen(true);
            };
            
            // Handle saving/updating an event
            const handleSaveEvent = (newEvent, isEditing) => {
                if (isEditing) {
                    // Handle event update
                    if (newEvent.type === 'recurring') {
                        // Update recurring event
                        let updatedRecurring;
                        
                        if (selectedEvent.id && selectedEvent.id.startsWith('recurring-')) {
                            // It's a locally created recurring event
                            updatedRecurring = localRecurringEvents.map(event => 
                                event.id === selectedEvent.id ? newEvent : event
                            );
                            setLocalRecurringEvents(updatedRecurring);
                            localStorage.setItem('techCalendarRecurringEvents', JSON.stringify(updatedRecurring));
                        } else {
                            // It might be a base event, but we'll add it as a local override 
                            // First remove any existing overrides
                            const filteredRecurring = localRecurringEvents.filter(event => 
                                event.id !== selectedEvent.id
                            );
                            
                            updatedRecurring = [...filteredRecurring, newEvent];
                            setLocalRecurringEvents(updatedRecurring);
                            localStorage.setItem('techCalendarRecurringEvents', JSON.stringify(updatedRecurring));
                        }
                    } else {
                        // Update one-time event
                        if (selectedEvent.id && selectedEvent.id.startsWith('event-')) {
                            // It's a locally created event
                            const updatedEvents = localEvents.map(event => 
                                event.id === selectedEvent.id ? newEvent : event
                            );
                            setLocalEvents(updatedEvents);
                            localStorage.setItem('techCalendarEvents', JSON.stringify(updatedEvents));
                        } else {
                            // It's a base event, we'll add it as a local override
                            // First remove it from the local events if it exists
                            const filteredEvents = localEvents.filter(event => 
                                event.id !== selectedEvent.id
                            );
                            
                            const updatedEvents = [...filteredEvents, newEvent];
                            setLocalEvents(updatedEvents);
                            localStorage.setItem('techCalendarEvents', JSON.stringify(updatedEvents));
                        }
                    }
                    
                    // Show success message
                    alert(`Event "${newEvent.title}" has been updated!`);
                } else {
                    // Handle new event creation
                    if (newEvent.type === 'recurring') {
                        // Save recurring event
                        const updatedRecurring = [...localRecurringEvents, newEvent];
                        setLocalRecurringEvents(updatedRecurring);
                        localStorage.setItem('techCalendarRecurringEvents', JSON.stringify(updatedRecurring));
                    } else {
                        // Save one-time event
                        const updatedEvents = [...localEvents, newEvent];
                        setLocalEvents(updatedEvents);
                        localStorage.setItem('techCalendarEvents', JSON.stringify(updatedEvents));
                    }
                    
                    // Show success message
                    alert(`Event "${newEvent.title}" has been created and saved to your browser!`);
                }
                
                // Reset and close
                setEditingEvent(null);
                setIsCreateEventOpen(false);
            };

            if (loading) {
                return <div className="text-center p-4">Loading calendar data...</div>;
            }

            if (error) {
                return (
                    <div className="p-6 max-w-6xl mx-auto">
                        <div className="text-red-500 text-center p-4 bg-red-100 border-red-300 border rounded-lg">
                            <h2 className="text-xl font-bold mb-2">Error Loading Calendar</h2>
                            <p>{error}</p>
                            <div className="mt-4 p-4 bg-yellow-50 border-yellow-200 border rounded text-left">
                                <h3 className="font-semibold mb-2">Troubleshooting Help:</h3>
                                <p className="mb-2">It looks like we couldn't find your events.json file. Here's how to fix it:</p>
                                <ol className="list-decimal pl-5 space-y-1">
                                    <li>Make sure your events.json file exists in one of these locations:
                                        <ul className="list-disc pl-5 mt-1">
                                            <li>public/data/events.json</li>
                                            <li>data/events.json</li>
                                            <li>events.json (at root)</li>
                                        </ul>
                                    </li>
                                    <li>If your file exists but is empty, make sure it has at least this structure:
                                        <pre className="bg-gray-100 p-2 mt-2 rounded">
                                            {JSON.stringify({ recurring: [], oneTime: [] }, null, 2)}
                                        </pre>
                                    </li>
                                    <li>If you need to move the file, copy it to the root directory of your repository.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="p-6 max-w-6xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold">
                            {viewMode === 'sponsors' ? 'Tech Community Sponsors' : '2025 Tech Community Calendar'}
                        </h1>
                        <div className="flex gap-3">
                            <button
                                onClick={() => {
                                    setEditingEvent(null);
                                    setIsCreateEventOpen(true);
                                }}
                                className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                <span>Create Event</span>
                                <Icon name="plus" />
                            </button>
                            <button
                                onClick={toggleView}
                                className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                            >
                                {viewMode === 'sponsors' ? (
                                    <>
                                        <span>Show Calendar</span>
                                        <Icon name="calendar" />
                                    </>
                                ) : (
                                    <>
                                        <span>See Sponsors</span>
                                        <Icon name="users" />
                                    </>
                                )}
                            </button>
                        </div>
                    </div>
                    
                    {/* Message about local storage */}
                    {(localEvents.length > 0 || localRecurringEvents.length > 0) && (
                        <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                            <div className="flex">
                                <div className="flex-shrink-0">
                                    <Icon name="info" className="text-blue-400" />
                                </div>
                                <div className="ml-3">
                                    <p className="text-sm text-blue-700">
                                        You have {localEvents.length + localRecurringEvents.length} locally created/modified event{(localEvents.length + localRecurringEvents.length) !== 1 ? 's' : ''}.
                                        Use the Admin Tools button at the bottom right to export all events or reset your local events.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Calendar View */}
                    {viewMode === 'calendar' && (
                        <>
                            <div className="space-y-6 mb-8">
                                <div className="flex flex-wrap gap-4 justify-center">
                                    {Object.entries(EVENT_COLORS).map(([type, color]) => (
                                        <div key={type} className="flex items-center gap-2">
                                            <div className={`w-4 h-4 rounded ${color}`}></div>
                                            <span className="capitalize">{type}</span>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="flex flex-wrap gap-4 justify-center">
                                    <div className="flex items-center gap-2">
                                        <Icon name="zap" className="text-yellow-500" />
                                        <span>Major Event</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="star" />
                                        <span>News Worthy</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="home" />
                                        <span>Has Sponsors</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="dollar-sign" />
                                        <span>Needs Sponsors</span>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                {MONTHS.map((month, index) => (
                                    <div key={month} className="bg-white rounded-lg shadow-md p-4">
                                        <h2 className="text-xl font-semibold mb-4">{month}</h2>
                                        <div className="space-y-2">
                                            {getEventsForMonth(index).map(event => (
                                                <div
                                                    key={event.id}
                                                    onClick={() => handleEventClick(event)}
                                                    className={`${EVENT_COLORS[event.type]} p-2 rounded cursor-pointer hover:opacity-90 transition-opacity`}
                                                >
                                                    <div className="flex items-center justify-between">
                                                        <span className={`${event.isMajor ? 'text-lg font-bold' : ''}`}>
                                                            {new Date(event.date).getDate()}: {event.title}
                                                        </span>
                                                        <div className="flex items-center gap-1">
                                                            {event.needsSponsors && <Icon name="dollar-sign" />}
                                                            {event.sponsors?.length > 0 && <Icon name="home" />}
                                                            {event.newsWorthy && <Icon name="star" />}
                                                            {event.isMajor && <Icon name="zap" className="text-yellow-500" />}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            {getEventsForMonth(index).length === 0 && (
                                                <div className="text-gray-500 italic text-center p-2">
                                                    No events scheduled
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </>
                    )}
                    
                    {/* Sponsors View */}
                    {viewMode === 'sponsors' && (
                        <SponsorsView 
                            eventData={eventData} 
                            recurringEvents={recurringEvents} 
                            formatDate={formatDate}
                            onEventClick={handleEventClick}
                        />
                    )}

                    {/* Event Details Dialog */}
                    <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
                        {selectedEvent && (
                            <DialogContent className="sm:max-w-md">
                                <DialogHeader>
                                    <div className="flex justify-between items-center">
                                        <DialogTitle>{selectedEvent.title}</DialogTitle>
                                        <button 
                                            onClick={handleEditEvent}
                                            className="text-blue-500 hover:text-blue-700 flex items-center gap-1"
                                        >
                                            <Icon name="edit-2" />
                                            <span>Edit</span>
                                        </button>
                                    </div>
                                </DialogHeader>
                                <div className="space-y-4">
                                    <p>{selectedEvent.description}</p>
                                    {selectedEvent.instanceDate && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="calendar" />
                                            <span>{formatDate(selectedEvent.instanceDate)}</span>
                                            <span className="text-sm text-gray-500">(Recurring)</span>
                                        </div>
                                    )}
                                    {!selectedEvent.instanceDate && selectedEvent.date && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="calendar" />
                                            <span>{formatDate(selectedEvent.date)}</span>
                                        </div>
                                    )}
                                    {selectedEvent.type === 'recurring' && !selectedEvent.instanceDate && selectedEvent.dayOfWeek !== undefined && selectedEvent.occurrences && Array.isArray(selectedEvent.occurrences) && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="repeat" />
                                            <span>
                                                Recurs on {['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][selectedEvent.dayOfWeek]},
                                                {selectedEvent.occurrences.map((n, i) => (
                                                    <span key={i}>
                                                        {i === 0 ? ' ' : ', '}
                                                        {n}{n === 1 ? 'st' : n === 2 ? 'nd' : n === 3 ? 'rd' : 'th'} week
                                                    </span>
                                                ))}
                                                of each month
                                            </span>
                                        </div>
                                    )}
                                    {selectedEvent.location && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="map-pin" />
                                            <span>{selectedEvent.location}</span>
                                        </div>
                                    )}
                                    {selectedEvent.organizer && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="user" />
                                            <span>Organizer: {selectedEvent.organizer}</span>
                                        </div>
                                    )}
                                    {selectedEvent.organizers && Array.isArray(selectedEvent.organizers) && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="users" />
                                            <span>Organizers: {selectedEvent.organizers.join(', ')}</span>
                                        </div>
                                    )}
                                    {selectedEvent.sponsors && Array.isArray(selectedEvent.sponsors) && selectedEvent.sponsors.length > 0 && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="home" />
                                            <span>Sponsors: {selectedEvent.sponsors.join(', ')}</span>
                                        </div>
                                    )}
                                    {selectedEvent.needsSponsors && (
                                        <div className="flex items-center gap-2 text-amber-600">
                                            <Icon name="dollar-sign" />
                                            <span>Seeking Sponsors</span>
                                        </div>
                                    )}
                                    {selectedEvent.isMajor && (
                                        <div className="flex items-center gap-2 text-yellow-500">
                                            <Icon name="zap" />
                                            <span>Major Event</span>
                                        </div>
                                    )}
                                    {selectedEvent.newsWorthy && (
                                        <div className="flex items-center gap-2">
                                            <Icon name="star" />
                                            <span>News Worthy Event</span>
                                        </div>
                                    )}
                                    <a
                                        href="#"
                                        onClick={(e) => {
                                            e.preventDefault();
                                            // Generate iCal for a single event
                                            const icalContent = generateICalendar(
                                                { 
                                                    oneTime: [selectedEvent.instanceDate ? 
                                                        {...selectedEvent, date: selectedEvent.instanceDate} : 
                                                        selectedEvent
                                                    ],
                                                    recurring: []
                                                }, 
                                                []
                                            );
                                            const blob = new Blob([icalContent], { type: 'text/calendar;charset=utf-8' });
                                            const url = URL.createObjectURL(blob);
                                            const a = document.createElement('a');
                                            a.href = url;
                                            a.download = `${selectedEvent.title.replace(/\s+/g, '_')}.ics`;
                                            a.click();
                                            URL.revokeObjectURL(url);
                                        }}
                                        className="flex items-center gap-2 text-blue-600 hover:text-blue-800"
                                    >
                                        <Icon name="download" />
                                        Add to Calendar
                                    </a>
                                </div>
                            </DialogContent>
                        )}
                    </Dialog>
                    
                    {/* Create/Edit Event Dialog */}
                    <Dialog open={isCreateEventOpen} onOpenChange={(open) => {
                        if (!open) setEditingEvent(null);
                        setIsCreateEventOpen(open);
                    }}>
                        <DialogContent className="sm:max-w-lg">
                            <EventCreator 
                                onSaveEvent={handleSaveEvent}
                                onCancel={() => {
                                    setEditingEvent(null);
                                    setIsCreateEventOpen(false);
                                }}
                                onDeleteEvent={handleDeleteEvent}
                                editEvent={editingEvent}
                            />
                        </DialogContent>
                    </Dialog>
                    
                    {/* Admin Panel */}
                    <AdminPanel 
                        eventData={eventData} 
                        recurringEvents={recurringEvents}
                        onResetLocalEvents={handleResetLocalEvents}
                    />
                </div>
            );
        };

        const App = () => {
            return (
                <div className="container mx-auto px-4">
                    <div id="calendar" className="py-4">
                        <TechCalendar />
                    </div>
                </div>
            );
        };

        // Make sure the DOM is loaded before rendering
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
